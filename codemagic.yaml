workflows:
  ios-workflow:
    name: iOS Workflow
    environment:
      groups:
        - firebase # Reference a group of environment variables
      vars:
        FIREBASE_APP_ID: "1:430197957945:ios:7027d28210ae90c8a8b4e8" # Replace with your Firebase app ID
    triggering:
      events:
        - push
      branch_patterns:
        - pattern: main
          include: true
          source: true
    scripts:
      - name: Set up keychain
        script: |
          keychain initialize
      - name: Install Flutter
        script: |
          flutter doctor -v
      - name: Install Firebase CLI
        script: |
          npm install -g firebase-tools --force
      - name: Decode Firebase token
        script: |
          FIREBASE_TOKEN=$(echo $FIREBASE_TOKEN | base64 --decode)
      - name: Build iOS
        script: |
          flutter build ipa --release --export-options-plist=ExportOptions.plist
      - name: Upload to Firebase App Distribution
        script: |
          firebase appdistribution:distribute build/ios/ipa/Runner.ipa \
            --app $FIREBASE_APP_ID \
            --token "$FIREBASE_TOKEN" \
            --groups yasmen
    artifacts:
      - build/ios/ipa/*.ipa
    publishing:
      email:
        recipients:
          - yasmenhosam412@gmail.com